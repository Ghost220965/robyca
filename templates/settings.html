<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Satan</title>
    <style>
        :root { --accent: #eee; --bg: #000; --panel: #030303; --border: #1a1a1a; --err: #ff3333; }
        * { box-sizing: border-box; font-family: 'JetBrains Mono', monospace; }
        body { background: var(--bg); color: var(--accent); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; border-right: 1px solid var(--border); padding: 50px 30px; display: flex; flex-direction: column; }
        .logo { font-size: 24px; font-weight: 900; letter-spacing: 15px; text-align: center; margin-bottom: 60px; text-transform: uppercase; color: #fff; }
        .nav-link { color: #555; text-decoration: none; padding: 12px 0; font-size: 10px; text-transform: uppercase; letter-spacing: 3px; border-bottom: 1px solid transparent; transition: 0.2s; }
        .nav-link.active { color: var(--accent); border-bottom: 1px solid var(--accent); }
        .main { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
        .card { background: var(--panel); border: 1px solid var(--border); padding: 40px; width: 100%; max-width: 700px; margin: 0 auto; }
        .upload-zone { margin-bottom: 25px; display: flex; flex-direction: column; gap: 10px; }
        .btn-group { display: flex; gap: 10px; }
        .up-box { padding: 30px; border: 1px dashed var(--border); text-align: center; cursor: pointer; background: #080808; flex: 1; transition: 0.3s; }
        .up-box:hover { border-color: var(--accent); background: #111; }
        .btn-del { padding: 10px; background: transparent; border: 1px solid var(--err); color: var(--err); cursor: pointer; text-transform: uppercase; font-size: 9px; width: 120px; transition: 0.3s; }
        .btn-del:hover { background: var(--err); color: #fff; }
        .btn-main { width: 100%; padding: 18px; background: var(--accent); color: #000; font-weight: bold; text-transform: uppercase; letter-spacing: 3px; cursor: pointer; border: none; margin-top: 10px; transition: 0.3s; }
        .btn-main:hover { background: #fff; transform: translateY(-2px); }
        #st { font-size: 9px; text-align: center; margin-top: 15px; color: #555; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo">SATAN</div>
        <a href="/config" class="nav-link">Config</a>
        <a href="/console" class="nav-link">Console</a>
        <a href="/autotyper" class="nav-link">Autotyper</a>
        <a href="/settings" class="nav-link active">Settings</a>
        <a href="#" class="nav-link" onclick="logout()" style="margin-top: auto; color: var(--err);">Logout</a>
    </aside>
    <main class="main">
        <div class="card">
            <div class="upload-zone">
                <div class="btn-group">
                    <div class="up-box" onclick="document.getElementById('fN').click()">
                        <label id="lN" style="cursor: pointer;">Upload delay notepad</label>
                        <input type="file" id="fN" hidden accept=".txt" onchange="ld(this,'n')">
                    </div>
                    <button class="btn-del" onclick="delPayload('n')">Delete Delay</button>
                </div>
            </div>
            <div class="upload-zone">
                <div class="btn-group">
                    <div class="up-box" onclick="document.getElementById('fS').click()">
                        <label id="lS" style="cursor: pointer;">Upload shift enter notepad</label>
                        <input type="file" id="fS" hidden accept=".txt" onchange="ld(this,'s')">
                    </div>
                    <button class="btn-del" onclick="delPayload('s')">Delete Shift</button>
                </div>
            </div>
            <button class="btn-main" onclick="save()">Set</button>
            <div id="st">Ready</div>
        </div>
    </main>

    <script>
        let pN = "", pS = "";

        // VerificƒÉm sesiunea »ôi √ÆncƒÉrcƒÉm datele existente
        async function load() {
            try {
                const res = await fetch('/get_autotyper');
                if (!res.ok) { window.location.href = '/'; return; }
                const d = await res.json();
                if(d) {
                    pN = d.payload || "";
                    pS = d.payload_shift || "";
                    updateLabels();
                }
            } catch(e) { document.getElementById('st').innerText = "Sync Error"; }
        }

        // Citirea fi»ôierului local
        function ld(i, m) {
            if (!i.files[0]) return;
            const r = new FileReader();
            r.onload = (e) => {
                if(m === 'n') pN = e.target.result;
                else pS = e.target.result;
                updateLabels();
                document.getElementById('st').innerText = "File prepared: " + i.files[0].name;
            };
            r.readAsText(i.files[0]);
        }

        // »òtergere payload
        async function delPayload(m) {
            if(!confirm("Are you sure you want to delete this payload?")) return;
            if(m === 'n') pN = ""; else pS = "";

            document.getElementById('st').innerText = "Processing deletion...";
            await syncToCloud();
            updateLabels();
        }

        function updateLabels() {
            document.getElementById('lN').innerText = pN ? "Success" : "üìÅ UPLOAD DELAY NOTEPAD";
            document.getElementById('lS').innerText = pS ? "Success" : "üìÅ UPLOAD SHIFT ENTER NOTEPAD";
        }

        // Func»õia de salvare (Sync)
        async function save() {
            document.getElementById('st').innerText = "Syncing with cloud...";
            const success = await syncToCloud();
            if (success) {
                alert("Payloads successfully synced to your cloud account.");
                document.getElementById('st').innerText = "Cloud Synced";
            }
        }

        // Helper pentru trimiterea datelor la server
        async function syncToCloud() {
            try {
                const res = await fetch('/save_autotyper', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        payload: pN,
                        payload_shift: pS
                    })
                });
                return res.ok;
            } catch(e) {
                alert("Connection lost.");
                return false;
            }
        }

        async function logout() {
            await fetch('/logout_api', { method: 'POST' });
            window.location.href = "/";
        }

        window.onload = load;
    </script>
</body>
</html>
